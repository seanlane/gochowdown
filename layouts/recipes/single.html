{{ define "title" }}
  {{ .Title }} Â· {{ .Site.Title }}
{{ end }}
{{ define "content" }}

<div class="container" itemscope itemtype="http://schema.org/Recipe">
<!-- call up the image and image credit link -->
  {{ with .Resources.ByType "image" }}
  {{ range . }}
    <div class="xs-p2">
      <img itemprop="image" src="{{ .RelPermalink }}" />
    </div>
  {{ end }}
  {{ end }}

  <article class="post-content px2">
    <!-- call up the main recipe title and content -->
    <header class="post-header">
      <h1 class="post-title center m1 sm-mt3" itemprop="name">{{ .Title }}</h1>
    </header>

    <div class="px2 mt3 clearfix">
      <div class="sm-col-8 center mx-auto" itemprop="description">{{.Content}}</div>
    </div>

    <!-- call up recipe and directions -->
    <div class="clearfix mt3">
      <div class="sm-col sm-col-6 lg-col-6">
        <!-- check if it's a component-based recipe -->
        {{ with .Params.Components}}
        <h4 class="blue mt0 mb2 xs-center">Components</h4>
        <ul>
          <!-- list components that make up recipe -->
          {{ range . }}
          <li>{{ . | markdownify}}</li>
          {{ end }}
        </ul>
        {{ end }}

        {{ with .Params.Ingredients }}
        <h4 class="blue mt0 mb2 xs-center">Ingredients</h4>
        <ul itemprop="ingredients">
          <!-- list ingredients that make up recipe -->
          {{ range . }}
          <li itemprop="recipeIngredient">{{ . | markdownify }}</li>
          {{ end }}
        </ul>
        {{ end }}
      </div>

      <div class="sm-col sm-col-6 lg-col-6">
        <h4 class="blue mt0 mb2 xs-center">Directions</h4>
        <ul itemprop="recipeInstructions">
          {{ range .Params.Directions }}
          <li>{{ . | markdownify }}</li>
          {{ end }}
        </ul>
      </div>
    </div>
    <!-- end recipe and directions --> 

    <!-- check if it's a component-based recipe, render it -->
    {{ with .Params.Components }}
    <div class="components bg-darken-2 p2 mt3 mb3 center">
      &darr; This is a <strong class="blue">component-based recipe</strong> (fancy talk for making the dish in pieces, then assembling). &darr;
    </div>
    
    <div class="clearfix mxn2">
    {{ range  . }}
      {{ $compTitle := . }}
      <div class="sm-col sm-col-4 px2">
      {{ range where $.Site.Pages "Title" $compTitle }}
        <h4 class="blue center">{{ .Title }}</h4>
        {{ range (.Resources.ByType "image") }}
        <div class="image ratio bg-cover" style="background-image:url({{ .RelPermalink }});">
          <img class="hide" itemprop="photo" src="{{ .RelPermalink }}" />
        </div>
        {{ end }}
        {{ if .Params.Imagecredit }}
          <a href="{{ .Params.Imagecredit }}" class="right">
            <svg class="js-geomicon geomicon" width="14" height="14" data-icon="camera" viewBox="0 0 32 32" style="fill:currentcolor">
              <title>camera icon</title>
              <path d="M0 6 L8 6 L10 2 L22 2 L24 6 L32 6 L32 28 L0 28 z M9 17 A7 7 0 0 0 23 17 A7 7 0 0 0 9 17"></path>
            </svg>
          </a>
        {{ end }}

        <h4 class="blue regular xs-center">Ingredients</h4>
        <ul class="ingredients" itemprop="ingredients">
          {{ range .Params.Ingredients }}
          <li itemprop="ingredient">{{ . | markdownify }}</li>
          {{ end }}
        </ul>
        
        <h4 class="blue regular xs-center">Steps</h4>
        <ul itemprop="instructions">
          {{ range .Params.Directions }}
          <li>{{ . | markdownify }}</li>
          {{ end }}
        </ul>

      {{ end }}
      </div>
    {{ end }}
    </div>
  
    {{ end }}
    <!-- end components -->  
    <br />

    {{ with .Params.Category }}{{ partial "taxonomy/category" . }}{{ end }}
    {{ with .Params.Cuisine }}{{ partial "taxonomy/cuisine" . }}{{ end }}
    {{ with .Params.Tags }}{{ partial "taxonomy/tags" . }}{{ end }}

  </article>
</div>

<script type="text/javascript">
  $( document ).ready(function() {
    jQuery.fn.clickToggle = function(a,b) {
      var ab=[b,a];
      function cb(){ ab[this._tog^=1].call(this); }
      return this.on("click", cb);
    };
    $("ul li").append('<input type="checkbox">');
    $("ul li").clickToggle(function(){
      $(this).children("input").prop('checked', true);
      var height = $(this).height();
      var y = $(window).scrollTop();
      $('html, body').animate({scrollTop: y+height+16}, 200);
    }, function(){
      $(this).children("input").prop('checked', false);
      var height = $(this).height();
      var y = $(window).scrollTop();
      $('html, body').animate({scrollTop: y-height-16}, 200);
    });
  });
</script>
{{ end }}
